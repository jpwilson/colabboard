# User Flows — Orim

Each flow lists the route sequence and auth state.

---

## 1. New User (Email)

```
Landing `/` → Click "Get Started"
  → Sign Up form `/login` (mode: sign-up)
  → Enter email + password → Submit
  → "Check your email for a confirmation link"
  → Click email link → `/auth/callback?code=...`
  → Session created → Redirect to `/dashboard`
```

**Auth state:** anonymous → authenticated
**Known limitation:** Supabase free tier limits to 4 confirmation emails/hour.

---

## 2. New User (OAuth)

```
Landing `/` → Click "Get Started"
  → `/login` → Click "Continue with Google" or "Continue with GitHub"
  → Redirect to OAuth provider
  → Authorize → Redirect to `/auth/callback?code=...`
  → Session created → Redirect to `/dashboard`
```

**Auth state:** anonymous → authenticated
**No email confirmation required** for OAuth signups.

---

## 3. Returning User

```
Landing `/` → Click "Sign In"
  → `/login` (mode: sign-in) → Enter email + password → Submit
  → Redirect to `/dashboard`
```

**Auth state:** anonymous → authenticated

---

## 4. Board Creation

```
Dashboard `/dashboard` → Click "New Board"
  → Server action creates board (slug auto-generated by PostgreSQL trigger)
  → Redirect to `/board/[slug]`
  → Canvas loads with toolbar, grid background
```

**Auth state:** authenticated (required)
**User becomes:** board owner

---

## 5. Board Sharing

```
Board `/board/[slug]` → Click "Share" button
  → Share modal opens with:
    - Copy invite link button
    - Member list with role/status badges
    - Invite by email form (owner only, with optional message)
  → Owner invites by email → Creates pending invitation
  → Invitee sees invitation on dashboard OR via share link
```

**Auth state:** authenticated, must be board member

---

## 6. Joining a Board

```
Receive invite link → Open `/board/[slug]/join`
  → If not logged in: redirect to `/login?next=/board/[slug]/join`
  → After login: return to `/board/[slug]/join`
  → Accept/Decline page shown with board name and inviter info
  → Accept → Added as board member (editor, accepted) → Redirect to `/board/[slug]`
  → Decline → Marked as declined → Redirect to `/dashboard`
  → Re-visit after decline → Accept/Decline shown again

Email invitation flow:
  Owner invites via Share modal → Pending row created
  → Invitee sees invitation card on `/dashboard`
  → Accept → Board appears in "Shared with You"
  → Decline → Invitation dismissed

Non-member accessing `/board/[slug]` directly → Redirected to `/board/[slug]/join`
```

**Auth state:** must be authenticated (redirected to login if not)

---

## 7. Collaboration (Real-Time)

```
Multiple users on `/board/[slug]`
  → Each user sees colored cursor with name label for all other users
  → Object creation/edit/move syncs instantly via Broadcast
  → Object state persisted to Postgres
  → Postgres Changes provide catch-up for missed broadcasts
  → Presence indicator shows online users in toolbar
```

**Sync architecture:** Broadcast (instant) → Postgres (persist) → Postgres Changes (catch-up)
**Conflict resolution:** Last-Write-Wins via `updated_at` timestamp

---

## 8. AI Commands (TODO — not yet implemented)

```
Board `/board/[slug]` → Open AI chat/command input
  → Type natural language command (e.g., "Create a SWOT analysis")
  → AI processes command → calls tool functions
  → Board objects created/modified via same sync pipeline
  → All users see AI-generated changes in real-time
```

**Requirement:** 6+ distinct command types
**Performance target:** <2 seconds for single-step commands

---

## 9. Sign Out

```
Any page → Click user menu → "Sign Out"
  → POST to `/auth/signout`
  → Session destroyed
  → Redirect to `/login`
```

**Auth state:** authenticated → anonymous

---

## Protected Routes

| Route Pattern | Requires Auth | Redirect If Not |
|---------------|---------------|-----------------|
| `/` | No | — |
| `/login` | No (redirects away if authed) | → `/dashboard` |
| `/dashboard` | Yes | → `/login` |
| `/board/[slug]` | Yes | → `/login?next=/board/[slug]` |
| `/board/[slug]/join` | Yes | → `/login?next=/board/[slug]/join` |
